<br>
<p>Most  of the times templates may include artifacts and components which needs to be  accessed during deployments. Some of these are</p>
<ul>
<li>Custom Scripts to be executed inside a VM</li>
<li>PowerShell Modules/DSC Modules to be used</li>
<li>Any other resources/components used by deployment</li>
</ul>
<br><p>When samples contain scripts, templates or other artifacts that need to be made available during deployment, using the standard parameters for staging those artifacts will enable command line deployment with the scripts provided at the root of the repository. This allows the template to be used in a variety of workflows without changing the templates or default parameters and the artifacts will be staged to a private location, rather than the public GitHub URI.</p>
<p>&nbsp;</p>
<p>First,  define two standard parameters:</p>
<ul>
<li><strong>_artifactsLocation</strong>:  This is the base URI where all artifacts for the deployment will be staged. The  default value should be the samples folder so that the sample can be easily  deployed in scenarios where a private location is not required.</li>
<li><strong>_artifactsLocationSasToken</strong>: &nbsp;this is the sasToken required to access  _artifactsLocation. The default value should be &quot;&quot; for scenarios  where the _artifactsLocation is not secured, for example, the raw GitHub URI
  <blockquote>
    <p>&quot;parameters&quot;:  {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;_artifactsLocation&quot;: {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;string&quot;,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;metadata&quot;: {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;description&quot;:  &quot;The base URI where artifacts required by this template are located. When  the template is deployed using the accompanying scripts, a private location in  the subscription will be used and this value will be automatically generated.&quot;<br>
      },<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;defaultValue&quot;:  &quot;https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-vm-custom-script-windows/&quot;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;_artifactsLocationSasToken&quot;: {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;:  &quot;securestring&quot;,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;metadata&quot;: {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&quot;description&quot;: &quot;The sasToken  required to access _artifactsLocation.&nbsp;  When the template is deployed using the accompanying scripts, a sasToken  will be automatically generated.&quot;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;defaultValue&quot;:  &quot;&quot;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <br>
      &nbsp; }, </p>
    <p>&nbsp;</p>
  </blockquote> 
</li>
</ul>


<p>In this example, the custom script  extension can be authored using a common pattern that can be applied to all  resources that need staged artifacts as well as applied to all samples.</p>
<blockquote>
  <p>&quot;properties&quot;:  {<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;publisher&quot;:  &quot;Microsoft.Compute&quot;,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;:  &quot;CustomScriptExtension&quot;,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;typeHandlerVersion&quot;:  &quot;1.8&quot;,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;autoUpgradeMinorVersion&quot;:  true,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;settings&quot;: {<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;fileUris&quot;: [<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &quot;[concat(parameters('_artifactsLocation'), '/',  variables('ScriptFolder'), '/', variables('ScriptFileName'),  parameters('_artifactsLocationSasToken'))]&quot;<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ],<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;commandToExecute&quot;:  &quot;[concat('powershell -ExecutionPolicy Unrestricted -File ',  variables('ScriptFolder'), '/', variables('ScriptFileName'))]&quot;<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
    &nbsp;&nbsp;&nbsp; } </p>
</blockquote>
